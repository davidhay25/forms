<!DOCTYPE html>
<html lang="en">
<head>
    <base href="/">
    <meta charset="UTF-8">
    <title>Data Standard designer</title>
    <script src="js/libs/jquery-1.9.0.min.js"></script>
    <script src="js/libs/angular.min1-5.js"></script>
    <script src="js/libs/ui-bootstrap-tpls-2.0.1.min.js"></script>

    <script src="js/libs/moment.min.js"></script>

    <link rel="stylesheet" type="text/css" href="css/jsTreeStyle.css"/>
    <link rel="stylesheet" type="text/css" href="css/jsTreeThemes/proton/style.css"/>

    <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css"/>
    <link rel="stylesheet" type="text/css" href="css/main.css"/>

    <script src="js/libs/angular-sanitize.js"></script>
    <script src="js/libs/jstree.min.js"></script>


    <link rel="stylesheet" type="text/css" href="css/vis.min.css"/>

    <style>
        .myScroll {
            height: 500px;
            overflow-y: scroll;
        }

        .horizontalButtonSpacer {
            margin-right: 8px;
        }

        .obsExtract {
            background-color: #ebcccc;
        }

         #submitGraph {
             width: 100%;
             height: 400px;
             border: 1px solid lightgray;
         }

         .checkoutbyme {
             color: green;
         }

         .checkoutbyother {
             color: red;
         }

        .pass {
            background-color: #dff0d8;
        }

        .fail {
            background-color: #e4b9c0;
        }

         .hide {
             display:none;
         }

         .selectedInList {
             font-weight: bold;
            // background-color: #d9d9d9;
         }

        .modal-vlg {
            width: 1200px;
        }

/*
        .tableFixHead {
            overflow-y: auto;
            height: 800px;
        }
        .tableFixHead thead th {
            position: sticky;
            top: 0;
        }
        table {
            border-collapse: collapse;
            width: 100%;
        }
        th,
        td {
            padding: 8px 16px;
            border: 1px solid #ccc;
        }
        th {
            background: #eee;
        }
*/
    </style>

    <script>
        angular.module("formsApp",['ui.bootstrap','ngStorage','ui.checkbox',"firebase"]).config(function($locationProvider) {

            // enable html5Mode for pushstate ('#'-less URLs)
            $locationProvider.html5Mode(true);
            $locationProvider.hashPrefix('!');
        });
        angular.module("formsApp").constant("moment", moment);
        angular.module("formsApp").config(['$compileProvider', function ($compileProvider) {
            $compileProvider.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|blob):/);
        }]);

    </script>
    <script src="js/libs/ngStorage.min.js"></script>

    <script src="js/designerCtrl.js"></script>
    <script src="js/formsService.js"></script>
    <script src="js/editItemCtrl.js"></script>

    <script src="js/libs/angular-bootstrap-checkbox.js"></script>
    <script src="js/filters.js"></script>

    <script src="js/formsCtrl.js"></script>
    <script src="js/formReviewsCtrl.js"></script>
    <script src="js/qSvc.js"></script>
    <script src="js/newQCtrl.js"></script>
    <script src="js/exportSvc.js"></script>
    <script src="js/importSectionCtrl.js"></script>
    <script src="js/importGroupCtrl.js"></script>
    <script src="js/terminologySvc.js"></script>
    <script src="js/terminologyCtrl.js"></script>
    <script src="js/graphSvc.js"></script>
    <script src="js/vsEditorCtrl.js"></script>
    <script src="js/libs/vis.min.js"></script>
    <script src="directive/noSpaces.js"></script>

    <script src="js/qManagementCtrl.js"></script>
    <!--  <script src="js/dispositionCtrl.js"></script> -->

    <script src="js/termIOCtrl.js"></script>
    <script src="js/termIOSvc.js"></script>
    <script src="js/importTerminologyCtrl.js"></script>
    <script src="js/loginCtrl.js"></script>
    <script src="js/modalDialogSvc.js"></script>
    <script src="js/termUpdateCtrl.js"></script>
    <script src="js/termUpdateSvc.js"></script>
    <script src="js/fhirSvc.js"></script>
    <script src="js/fhirCtrl.js"></script>
    <script src="js/editCodesCtrl.js"></script>

    <script src="js/libs/firebase.js"></script>
    <script src="js/libs/angularfire.min.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyDG1ToLHycsMUX0CfX0OZVSRUUpFQeKE9o",
            authDomain: "canshare-730e6.firebaseapp.com",
            projectId: "canshare-730e6",
            storageBucket: "canshare-730e6.appspot.com",
            messagingSenderId: "12147821347",
            appId: "1:12147821347:web:5963d577cb050259475a96"
        };
        if (firebase) {
            console.log('init firebase')
            firebase.initializeApp(firebaseConfig);

        }
    </script>


</head>
<body style="padding: 8px;padding-top: 80px">
    <div ng-app="formsApp" ng-controller="designerCtrl" class="container-fluid">

    <nav class="navbar navbar-default navbar-fixed-top" role="navigation">

        <div class="container-fluid">
            <div class="col-md-6 col-sm-6">
                    <span>
                        <a class="navbar-brand" href="#">
                            Data Standard designer<span ng-show="selectedQ">:</span> {{selectedQ.name}}
                        </a>
                    </span>
            </div>

            <div class="col-md-1 col-sm-1">
                <div class="navbar-text">

                </div>

            </div>

            <div class="col-md-1 col-sm-1">
                <form class="navbar-form navbar-left">
                    <img ng-show="showWaiting" src="css/ajax_loader_blue_32.gif"/>

                </form>
            </div>



            <div class="col-md-2 col-sm-2">
                <div class="navbar-text">
                    <button class="btn btn-link" ng-click="input.togglePane()">Toggle data standard list</button>
                </div>

            </div>

            <div class="col-md-1 col-sm-1">
                <div class="navbar-text " ng-hide="user">
                    <span style="font-size:1.2em; cursor: pointer" uib-popover="Click to log in"
                          popover-placement="left"
                          popover-trigger="'mouseenter'">
                        <div ng-click="login()">
                            <i class="glyphicon glyphicon-log-in"></i>
                        </div>
                    </span>
                </div>

                <div class="navbar-text pull-right"  ng-show="user">
                    <span style="font-size:1.2em;  cursor: pointer" uib-popover="{{user.email}}"
                          popover-placement="left"
                          popover-trigger="'mouseenter'">
                        <div ng-click="logout()">
                            <i class="glyphicon glyphicon-log-out"></i>
                        </div>
                    </span>
                </div>

            </div>

            <div class="col-md-1 col-sm-1">

                <a target="_blank"
                   href="https://docs.google.com/document/d/1ORjWXOCwrE8CqolB3rH3HC5J49DyphxG1q9hgjQcE2A/edit?usp=sharing">
                    <i class="glyphicon glyphicon-question-sign navbar-text">  </i>
                </a>

            </div>
        </div>
    </nav>

    <uib-tabset>


        <!-- The Q is checked out to another user -->
        <div ng-show="checkoutIdentifier.value && checkoutIdentifier.value !== user.email">
            <strong class="pull-right">Checked out to {{checkoutIdentifier.value}}</strong>
        </div>

        <!-- The Q is checked out to the current user-->
        <div ng-show="user.email && checkoutIdentifier.value == user.email">

            <!-- Check in any changes -->
            <button class="btn btn-success pull-right horizontalButtonSpacer"
                    uib-popover="Upload the updated model to the server, releasing the check out lock."
                    popover-placement="left"
                    popover-trigger="'mouseenter'"
                    ng-click = "checkin()">Check in</button>

            <!-- If has been changed, then can update in local cache (or do this automatically - yes, saved automatically?
            <div ng-show="input.dirty">
                <button class="btn btn-primary pull-right horizontalButtonSpacer" ng-click = "updateLocalCache(selectedQ)">Save in local cache</button>
            </div>
-->
            <!--  Discard any local changes-->
            <button class="btn btn-danger pull-right horizontalButtonSpacer"
                    uib-popover="Discard the local changes"
                    popover-placement="left"
                    popover-trigger="'mouseenter'"
                    ng-click = "revert(miniQ)">Revert</button>



        </div>

        <!-- The Q is not checked out, but there is a logged in user, so could potentially be checked out (unless this is being invoked on the public site)-->
        <div ng-show="! checkoutIdentifier.value && user.email && selectedQ && systemConfig.type !== 'public'">
            <button class="btn btn-success pull-right"
                    uib-popover="Save this model locally, and allow editing"
                    popover-placement="left"
                    popover-trigger="'mouseenter'"
                    ng-click="checkout(selectedQ)">Check out</button>

            <!--  Publish-->
            <button class="btn btn-danger pull-right horizontalButtonSpacer"
                    uib-popover="Will copy the Q to the public server"
                    popover-placement="left"
                    popover-trigger="'mouseenter'"
                    ng-click = "publish(selectedQ)">Publish (not yet enabled)</button>

        </div>

        <!-- No user login - read only-->
        <div ng-show = "!user.email && !  checkoutIdentifier.value">
            <div class="pull-right">Login to enable update (via check in / check out)</div>
        </div>

        <uib-tab heading="Questionnaire resources">
            <br/>

            <div class="row">
                <div ng-class="input.leftPane">

                    <div class="row">
                        <div class="col-md-4">
                            <div style="margin-top: 6px">Folder</div>
                        </div>
                        <div class="col-md-8">
                            <select class="form-control" ng-model="input.selectedFolderTag"
                                    ng-change = "selectTag(input.selectedFolderTag)"
                                    ng-options = "tag for tag in folderTags">
                            </select>
                        </div>
                    </div>
                    <br/>

                    <div class="myScroll">
                        <div class="list-group">
                            <div ng-class="{'list-group-item':true,'listItemSelected':miniQ.id == selectedQ.id}"
                                 style="cursor: pointer"
                                 ng-show="miniQ.hashFolderTag[input.selectedFolderTag]"
                                 ng-click="selectQ(miniQ)"
                                 ng-repeat="miniQ in allQ">
                                {{miniQ.name}}
                                <!--
                                <div>{{Q.checkedoutTo}}</div>
                                -->

                                <div ng-show="miniQ.checkedoutTo">

                                    <em ng-class="{checkoutbyme:miniQ.checkedoutTo == 'me',checkoutbyother:miniQ.checkedoutTo !== 'me'}">
                                        Checked out by {{miniQ.checkedoutTo}}
                                    </em>


                                </div>

                            </div>
                        </div>
                    </div>

                    <button class="btn btn-link" ng-show="user.email"
                            ng-click="newQ()">
                        New Questionnaire
                    </button>

                </div>

                <div ng-class="input.rightPane">


                    <!-- If the Q is not checkedout, then it cannot be updated - only saved locally-->
                    <div class="alert alert-warning" ng-show="showLoading">
                        Loading, please wait....
                    </div>

                    <div class="alert alert-success" ng-show="miniQ.checkedoutTo == 'me' && selectedQ">
                        Model is checked out and local browser copy is being edited. Use the 'Check In' button to update the server when finished editing.
                        Use 'Revert' to discard your changes.
                    </div>


                    <div class="alert alert-warning" ng-hide="miniQ.checkedoutTo == 'me' || !selectedQ || systemConfig.type == 'public'">
                        This is a readonly view.
                        <span ng-show = "miniQ.checkedoutTo">It has been checked out by {{miniQ.checkedoutTo}}</span>
                        <span ng-hide = "miniQ.checkedoutTo">
                            To edit, <span ng-hide="user.email">log in, then</span>  check out the model, edit it, and check it back in.
                        </span>
                    </div>

                    <div class="alert alert-warning" ng-show="systemConfig.type == 'public'">
                        This app is being executed on the Public site, and so check out has been disabled. Use the Designer site instead.
                    </div>

                    <uib-tabset ng-show="treeData">

                        <uib-tab heading="Q Items tree">

                            <div class="row">
                                <div class="col-md-5">

                                    <div class="pull-right">

                                        <a ng-show="downloadLinkQName" class="btn btn-link pull-right" download="{{downloadLinkQName}}"
                                           href="{{downloadLinkQ}}" title="{{downloadLinkQName}}" >
                                            Download Q
                                        </a>


                                        <button class="btn btn-link" ng-click="expandAll()">Expand all</button>
                                        <button class="btn btn-link" ng-click="showSection()">Show sections</button>
                                    </div>




                                    <div class="clearfix"></div>
                                    <br/>


                                    <div class="myScroll">
                                        <div id="designTree"></div>
                                    </div>


                                </div>
                                <div class="col-md-7">

                                    <uib-tabset>

                                        <uib-tab heading="Details">

                                            <div ng-show = "selectedNode">
                                                <ng-include src = "'includes/itemDetails.html'"></ng-include>

                                                <hr/>


                                                <div ng-show = "miniQ.checkedoutTo == 'me'" class="row">

                                                    <div class="col-md-2">
                                                        <button class="btn btn-link" ng-hide = "selectedNode.id == 'root'"
                                                                ng-click="editItem(selectedNode)">
                                                            Edit item
                                                        </button>

                                                        <button class="btn btn-link"
                                                                ng-show = "selectedNode.data.item.type=='choice'"
                                                                ng-click="codeGroup(selectedNode)">
                                                            Edit codes
                                                        </button>
                                                    </div>

                                                    <div class="col-md-3">
                                                        <div ng-show="selectedNode.data.level == 'root'">
                                                            <button class="btn btn-link"
                                                                    ng-click="addItem(selectedNode,'section')">
                                                                Add new section
                                                            </button>

                                                            <div>
                                                                <button class="btn btn-link"
                                                                        ng-click="importSection()">
                                                                    Import section
                                                                </button>
                                                            </div>

                                                        </div>

                                                        <div ng-show="selectedNode.data.level == 'section' ">

                                                            <button class="btn btn-link"
                                                                    ng-click="addItem(selectedNode,'child')">
                                                                Add child element item
                                                            </button>

                                                            <div>
                                                                <button class="btn btn-link"
                                                                        ng-click="addItem(selectedNode,'group')">
                                                                    Add new Group
                                                                </button>
                                                            </div>

                                                            <div>
                                                                <button class="btn btn-link"
                                                                        ng-click="importGroup(selectedNode)">
                                                                    Import Group
                                                                </button>
                                                            </div>


                                                        </div>


                                                        <div ng-show="selectedNode.data.level == 'child'">
                                                            <button class="btn btn-link"
                                                                    ng-click="addItem(selectedNode,'child',true)">
                                                                Add sibling element
                                                            </button>

                                                            <button class="btn btn-link"
                                                                    ng-click="addItem(selectedNode,'grandchild')">
                                                                Add child element
                                                            </button>

                                                            <button  ng-show="selectedNode.data.item.item.length > 0" class="btn btn-link"
                                                                    ng-click="makeChoiceElement(selectedNode)">
                                                                Convert to choice
                                                            </button>



                                                        </div>

                                                        <div ng-show="selectedNode.data.level == 'grandchild'">
                                                            <button class="btn btn-link"
                                                                    ng-click="addItem(selectedNode,'grandchild',true)">
                                                                Add sibling element
                                                            </button>

                                                        </div>


                                                    </div>


                                                    <div class="col-md-2">
                                                        <div ng-show="selectedNode  && selectedNode.id !== 'root'">
                                                            <button class="btn btn-link"
                                                                    ng-click="moveUp(selectedNode)">
                                                                Move up
                                                            </button>

                                                            <div>
                                                                <button class="btn btn-link"
                                                                        ng-click="moveDown(selectedNode)">
                                                                    Move Down
                                                                </button>
                                                            </div>


                                                        </div>
                                                    </div>

                                                    <div class="col-md-2">
                                                        <div ng-show="selectedNode && selectedNode.id !== 'root'">
                                                            <button class="btn btn-link"
                                                                    ng-click="removeElement(selectedNode)">
                                                                Remove element
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>

                                            </div>


                                        </uib-tab>

                                        <uib-tab heading="Search">
                                            <br/>
                                            <ng-include src = "'includes/search.html'"></ng-include>

                                        </uib-tab>

                                        <uib-tab heading="Meta">
                                            <em>Only for developer use</em>
                                            <pre>{{selectedNode.data.meta | json}}</pre>

                                        </uib-tab>


                                        <uib-tab heading="Json">
                                            <em>Only for developer use</em>
                                            <pre>{{selectedNode.data.item | json}}</pre>

                                        </uib-tab>


                                    </uib-tabset>

                                </div>
                            </div>


                        </uib-tab>

                        <uib-tab>
                            <uib-tab-heading>
                                Dependencies
                                <span class="badge">
                                    {{dependencyErrors()}}
                                </span>
                            </uib-tab-heading>

                            <button class="btn btn-link pull-right" ng-click="makeQDependancyAudit()">Update audit</button>
                            <div class="clearfix"></div>
                            <div class="tableFixHead">
                            <table class="table table-bordered">
                                <thead>
                                <tr><th>This item is...</th><th>...dependant on this one to show</th><th>Operator</th><th>Operand (what is being compared in the dependant item)</th></tr>
                                </thead>
                                <tr ng-repeat="aud in dependencyAudit"
                                    ng-class="{pass:aud.ok,fail: ! aud.ok}">
                                    <td>
                                        <div class="clickable" ng-click="editItemFromLinkId(aud.source)">
                                            <div>{{aud.sourceText}}</div>
                                            <em>{{aud.source}}</em>

                                        </div>

                                    </td>
                                    <td>
                                        <div class="clickable" ng-click="editItemFromLinkId(aud.target)">
                                            <div>{{aud.controllerText}}</div>
                                            <em>{{aud.target}}</em>
                                        </div>
                                    </td>
                                    <td>
                                        {{aud.dep.operator}}

                                    </td>
                                    <td>
                                        {{aud.dep.answerBoolean}} {{aud.dep.answerCoding}}
                                        <div>{{aud.err}}</div>
                                    </td>
                                </tr>
                            </table>
                            </div>





                        </uib-tab>

                        <uib-tab ng-show="false" heading="Search">
                            <br/>
                            <ng-include src = "'includes/search.html'"></ng-include>

                        </uib-tab>

                        <uib-tab heading="Summaries">
                            <br/>

                            <ng-include src = "'includes/renderReport.html'"></ng-include>

                            <br/>
                        </uib-tab>

                        <uib-tab heading="Q metadata">
                            <br/>

                            <ng-include src = "'includes/qMetaData.html'"></ng-include>

                            <div ng-show="user.email && checkoutIdentifier.value == user.email">
                                <button class="btn btn-link pull-right" ng-click="retireQ()">Retire Questionnaire</button>
                            </div>


                        </uib-tab>

                        <uib-tab heading="Form preview">
                            <br/>

                            <uib-tabset>

                                <uib-tab heading = "Edit">
                                    <div class="clickable pull-right" ng-click="setDefaults()">Set defaults</div>


                                    <br/>


                                    <div ng-controller="formsCtrl">
                                        <ng-include src = "'includes/renderFormAsTab2.html'"></ng-include>
                                    </div>

                                </uib-tab>

                                <uib-tab heading = "Preview">
                                    <ng-include src = "'includes/renderFormForDisplay.html'"></ng-include>
                                </uib-tab>


                                <uib-tab heading = "Raw form data">
                                    <pre>{{form | json}}</pre>
                                </uib-tab>
                                <uib-tab heading = "QR">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <pre>{{selectedQR | json}}</pre>
                                        </div>
                                        <div class="col-md-6">
                                            <button class="btn btn-link" ng-click="validateQR(selectedQR)">Validate</button>
                                            <pre>{{qrValidationResult | json}}</pre>

                                        </div>
                                    </div>

                                </uib-tab>

                                <uib-tab ng-show="selectedQR" heading = "Test QR submission">
                                    <button class="btn btn-link pull-right" ng-click="testSubmit()">Test submission</button>

                                    <div class="row">
                                        <div class="col-md-3">
                                            <div class="list-group">
                                                <div ng-class="{'list-group-item':true,listItemSelected:selectedResource.id == item.resource.id}"
                                                     ng-click = "selectResource(item)"
                                                     style="cursor: pointer"
                                                     ng-repeat = "item in extractedResources">

                                                    <span class="pull-right">
                                                        <i ng-show = "item.valid" style="color: green" class="glyphicon glyphicon-thumbs-up"></i>
                                                        <i ng-hide = "item.valid" style="color: red" class="glyphicon glyphicon-thumbs-down"></i>
                                                    </span>

                                                    {{item.resource.resourceType}}

                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-md-5">
                                            <div id="submitGraph"></div>
                                        </div>
                                        <div class="col-md-4">
                                            <uib-tabset ng-show="selectedResource">
                                                <uib-tab heading="Json">
                                                    <pre>{{selectedResource | json}}</pre>
                                                </uib-tab>
                                                <uib-tab heading="Validation result">
                                                    <pre>{{selectedResourceValidation | json}}</pre>

                                                </uib-tab>

                                            </uib-tabset>

                                        </div>
                                    </div>


                                </uib-tab>


                            </uib-tabset>


                        </uib-tab>

                        <uib-tab heading = "Review Url">
                            <br/>

                                <div>
                                    Review UI Url:

                                    <strong>
                                    <a target="_blank"
                                       ng-href="dataStandards.html?{{selectedQ.id}}">
                                        https://canshare.co.nz/dataStandards.html?{{selectedQ.id}}
                                    </a>
                                        <!--  <a target="_blank"
                                       ng-href="reviewForm.html?{{selectedQ.url}}">
                                        http://canshare.clinfhir.com/reviewForm.html?{{selectedQ.url}}
                                    </a> -->

                                </strong>
                                </div>

                        </uib-tab>
                        <uib-tab heading = "Audit Report">
                            <!--<uib-tab heading = "HISO SpreadSheet"> -->
                            <a ng-show="downloadLinkCsvName" class="btn btn-link pull-right" download="{{downloadLinkCsvName}}"
                               href="{{downloadLinkCsv}}" title="{{downloadLinkCsvName}}" >
                                Download CSV file
                            </a>

                            <div class="clearfix"></div>

                            <div class="tableFixHead">
                                <table class="table table-condensed table-bordered">
                                <thead>
                                    <tr>
                                        <th ng-repeat = "col in auditReportHeader">{{col}}</th>
                                    </tr>
                                </thead>
                                <tr ng-repeat="row in auditReport">


                                 <td ng-repeat = "col in row track by $index">
                                        {{col}}
                                    </td>
                                </tr>
                            </table>
                            </div>



                            <!--

                              <pre>{{auditReport | json}}</pre>

                            <div class="row">
                                <div class="col-md-6">
                                    <strong>Json</strong>
                                    <pre>{{exportJsonList | json}}</pre>
                                </div>
                                <div class="col-md-6">
                                    <strong>table</strong>
                                    <pre>{{auditReport | json}}</pre>
                                </div>
                            </div>
                            -->

<!--

<ng-include src="'includes/hisoTable.html'"></ng-include>

                            <div ng-repeat = "section in exportJsonList">
                                <h4>{{section.display}}</h4>
                                <table class="table table-bordered">
                                    <tr><th>Name</th><th>Description</th><th>Card.</th><th>Obligation</th><th>HISO specific</th><th>Data Domain</th></tr>
                                    <tr ng-repeat = "line in section.lines">
                                        <td width="10%">


                                           <div class="clickable" ng-click="editItemFromReport({item:line.item})">
                                                   {{line.name}}
                                            </div>


                                        </td>

                                        <td width="15%">{{line.description}}</td>
                                        <td width="5%">{{line.cardinality}}</td>
                                        <td width="7%">{{line.obligation}}</td>
                                        <td width="35%">

                                            <strong ng-show="line.hisoDT">DT:</strong> {{line.hisoDT}}
                                            <strong ng-show="line.hisoClass">Class:</strong> {{line.hisoClass}}
                                            <strong ng-show="line.hisoLength">Length:</strong> {{line.hisoLength}}
                                            <strong ng-show="line.hisoLayout">Layout:</strong> {{line.hisoLayout}}

                                            <div>{{line.usageNotes}}</div>
                                        </td>
                                        <td>{{line.dataDomain}}</td>
                                    </tr>
                                </table>
                            </div>
-->
                        </uib-tab>

                        <uib-tab ng-show = "false" heading="Terminology Update">
                            <div ng-controller="termUpdateCtrl">
                                <ng-include src = "'includes/termUpdate.html'"></ng-include>

                            </div>
                        </uib-tab>

                        <uib-tab  ng-show = "false" heading="ValueSets">
                            <br/>
                            <div ng-controller="terminologyCtrl">
                                <button class="btn-link btn pull-right" data-ng-click="updateVS()">Make summary</button>

                                <table class="table table-bordered">
                                    <tr><th>Url</th><th>LinkId</th><th>Local</th><th>Copy</th><th>Remote</th></tr>
                                    <tr ng-repeat="item in arVS">
                                        <td>{{item.vsUrl}}</td>
                                        <td>
                                            <span class="clickable" ng-click="editItemFromLinkId(item.linkId)">
                                                 {{item.linkId}}
                                             </span>
                                           </td>
                                        <td>
                                            <div class="clickable" ng-click="viewVS(item.vsUrl)" >
                                                <div ng-repeat="inc in item.local.compose.include">
                                                    {{inc.system}}  {{inc.concept.length}}
                                                </div>
                                            </div>
                                        </td>
                                        <td>
                                            <i class="clickable glyphicon glyphicon-arrow-right"></i>

                                            <div>
                                                <i class="clickable glyphicon glyphicon-arrow-left"
                                                   ng-click="downloadFromRemote(item)"></i>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="clickable" ng-click="viewVS(item.vsUrl,true)" >
                                                <div ng-repeat="inc in item.remote.compose.include">
                                                    {{inc.system}}  {{inc.concept.length}}
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                </table>
                                <!--
                                <div class="row" ng-repeat="item in arVS">
                                    <div class="col-md-3">
                                        {{item.vsUrl}}
                                    </div>
                                    <div class="col-md-3">
                                        <div ng-repeat="inc in item.local.compose.include">
                                            {{inc.system}}  {{inc.concept.length}}
                                        </div>

                                    </div>
                                    <div class="col-md-3">
                                        <div ng-repeat="inc in item.remote.compose.include">
                                            {{inc.system}}  {{inc.concept.length}}
                                        </div>

                                    </div>

                                </div>

-->
                            </div>
                        </uib-tab>

                        <uib-tab heading="Validate Q">
                            <br/>
                            <div class="row">
                                <div class="col-md-12">
                                    <button class="btn btn-link pull-right" ng-click="validateQ()">Validate</button>
                                </div>
                            </div>


                            <uib-tabset>
                                <uib-tab heading="List">
                                    <table class="table table-bordered">
                                        <tr ng-repeat = "iss in QValidation.issue">
                                            <td>{{iss.diagnostics}}</td>
                                            <td>
                                                {{iss.location[0]}}
                                            </td>
                                        </tr>
                                    </table>

                                </uib-tab>
                                <uib-tab heading="Json">
                                    <pre>{{QValidation | json}}</pre>
                                </uib-tab>
                            </uib-tabset>



                        </uib-tab>

                        <uib-tab ng-show="false" heading="Sample Instances">
                            <em>Create example bundles. Only used by FHIR designer.</em>


                            <div ng-controller="fhirCtrl">
                                <button class="btn btn-link pull-right" ng-click="makeSample(selectedQ)">Generate instance</button>
                                <ng-include src = "'includes/instanceDisplay.html'"></ng-include>
                            </div>



                        </uib-tab>

                        <uib-tab heading="Q Json">
                            <pre>{{selectedQ | json}}</pre>
                        </uib-tab>


                    </uib-tabset>

                </div>
            </div>

        </uib-tab>

        <uib-tab ng-show="false" heading="Form reviews">
            <br/>

            <div ng-controller="formReviewsCtrl">
                <ng-include src = "'includes/formReviews.html'"></ng-include>
            </div>

        </uib-tab>


        <uib-tab ng-show="false" heading="Form review dispositions">
            <br/>
            <div class="row">

                <div class="col-md-2">
                    <div class="myScroll">
                        <div class="list-group">
                            <div ng-class="{'list-group-item':true,'listItemSelected':Q.id == selectedQ.id}"
                                 style="cursor: pointer"
                                 ng-click="loadDispositionsForQ(Q)"
                                 ng-repeat="Q in allQ">
                                {{Q.name}}
                            </div>
                        </div>
                    </div>


                </div>
                <div class="col-md-10">
                    <table ng-show="dispositionsForQ" class="table table-condensed table-bordered">
                        <tr><th>Reviewer</th><th>Date</th><th>Type</th><th>Comment</th><th>Disposition date</th><th>Disposition</th><th>Note</th></tr>
                        <tr ng-repeat = "item in dispositionsForQ">
                            <td>{{item.author}}</td>
                            <td>{{item.authored | date : 'dd-MMM-yyyy'}}</td>
                            <td>{{item.linkId}}</td>
                            <td>{{item.comment}}</td>
                            <td>{{item.dispositionDate | date : 'dd-MMM-yyyy'}}</td>
                            <td>{{item.disposition.display}}</td>
                            <td>{{item.note}}</td>
                        </tr>
                    </table>
                   <!-- <pre>{{dispositionsForQ | json}}</pre> -->
                </div>
            </div>


        </uib-tab>

        <uib-tab ng-show="false" heading="ValueSets used">

            <div ng-controller="terminologyCtrl">
                <br/>

                <ng-include src = "'includes/terminology.html'"></ng-include>

            </div>

            </uib-tab>

        <uib-tab ng-show="user.email == 'david.hay25@gmail.com'" heading = "Q Management">

                <ng-include src = "'includes/qManagement.html'"></ng-include>

        </uib-tab>


        </uib-tabset>

</div>

</body>
</html>